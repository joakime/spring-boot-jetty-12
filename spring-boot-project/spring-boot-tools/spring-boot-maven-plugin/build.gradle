plugins {
	id 'org.springframework.boot.conventions'
	id 'org.springframework.boot.maven-plugin'
	id 'org.springframework.boot.optional-dependencies'
	id 'org.asciidoctor.jvm.convert'
	id 'org.asciidoctor.jvm.pdf'
}

configurations {
	documentation
}

dependencies {
	implementation project(':spring-boot-project:spring-boot-tools:spring-boot-loader-tools')
	implementation 'org.apache.maven.shared:maven-common-artifact-filters:3.1.0'
	implementation 'org.apache.maven:maven-plugin-api:3.6.2'
	
	runtime 'org.sonatype.plexus:plexus-build-api:0.0.7'

	compileOnly 'org.apache.maven.plugin-tools:maven-plugin-annotations:3.6.0'
	compileOnly 'org.sonatype.plexus:plexus-build-api:0.0.7'

	optional 'org.apache.maven.plugins:maven-shade-plugin:3.2.1'

	testImplementation enforcedPlatform(project(':spring-boot-project:spring-boot-parent'))
	testImplementation 'org.apache.maven.shared:maven-invoker:3.0.1'
	testImplementation 'org.assertj:assertj-core'
	testImplementation 'org.junit.jupiter:junit-jupiter'
	testImplementation 'org.mockito:mockito-core'
	testImplementation 'org.springframework:spring-core'
}

tasks.withType(org.asciidoctor.gradle.jvm.AbstractAsciidoctorTask) {
	baseDirFollowsSourceDir()
	dependsOn documentPluginGoals
	attributes	'asciidoc-sources-root': file('src/docs/asciidoc'),
				'attribute-missing': 'warn',
				'generated-resources-root': "$buildDir/docs/generated",
				'maven-jar-plugin-version': '1.2.3',
				'maven-failsafe-plugin-version': '1.2.3',
				'build-helper-maven-plugin-version': '1.2.3',
				'sources-root': file('src')
}

task zip(type: Zip) {
	dependsOn asciidoctor, asciidoctorPdf
	duplicatesStrategy 'fail'
	from(asciidoctorPdf.outputDir) {
		into 'pdf'
	}
	from(asciidoctor.outputDir) {
		into 'html'
	}
}

prepareMavenBinaries {
	versions '3.6.2', '3.5.4'
}

artifacts {
	'documentation' zip
}
